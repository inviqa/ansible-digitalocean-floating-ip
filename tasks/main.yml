---
- name:       check if DO Droplet exists
  stat:
    path:     "{{ jumpcloud_agent_config }}"
  register:   jumpcloud_agent_config_status

- name:       Retrive status of the DO Floating IP
  stat:
    path:     "{{ jumpcloud_agent_config }}"
  register:   do_floating_ip_is_assigned

- name:       Unassign the DO Floating IP
  comman: >
  delegate_to: localhost
  when:       do_floating_ip_is_assigned is true
  set_fact:   do_floating_ip_is_not_assigned true

- name:       Assign the Floating IP to the give Droplet
  # command: >
  #         curl -iq \
  #                  -d '{
  #                     "type" : "assign",
  #                     "droplet_id" : "{{ digital_ocean_droplet_id }}",
  #                   }' \
  #                  -X 'PUT' \
  #                  -H 'Content-Type: application/json' \
  #                  -H 'Authorization: Bearer {{ digital_ocean_api_token }}' \
  #                  "{{ digital_ocean_api_base_url }}/{{digital_ocean_floating_ip}}/actions"
  # 
  uri:
    url: "{{ digital_ocean_api_base_url }}/{{digital_ocean_floating_ip}}/actions"
    headers:
      Content-Type:   'application/json'
      Authorization:  "Bearer {{digital_ocean_api_token}}"
    body_format:  json
    body:
      type: 'assign'
      droplet_id: "{{ digital_ocean_droplet_id }}"
    method: PUT
    follow_redirects: all
    return_content: yes
  delegate_to: localhost
  register: http_outcome
  #no_log: True
  when: do_floating_ip_is_not_assigned is true
